class Solution {
    int[] parent;
    int[] size;
    public int minMalwareSpread(int[][] graph, int[] initial) {
        int n = graph.length;
        
        parent = new int[n];
        size = new int[n];
        
        for(int i=0; i<n; i++) {
            parent[i] = i;
            size[i] = 1;
        }
        
        HashSet<Integer> set = new HashSet<>();
        for(int i : initial) {
            set.add(i);
        }
        
        for(int i=0; i<n; i++) {
            for(int j=0; j<n; j++) {
                if(graph[i][j] == 1 && !set.contains(i) && !set.contains(j)) {
                    union(i, j);
                }
            }
        }
        
        HashMap<Integer, HashSet<Integer>> map = new HashMap<>();
        int[] infected = new int[n];
        
        for(int u : initial) {
            map.put(u, new HashSet<>()); 
            for(int j=0; j<n; j++) {
                if(graph[u][j] == 1 && u != j && !set.contains(j)) {
                    int p = find(j);
                    if(map.get(u).contains(p)) continue;
                    map.get(u).add(p);
                    infected[p]++;
                }
            }
        }
        
        int ans = -1;
        int max = -1;
        
        for(int u:initial) {
            HashSet<Integer> pars = map.get(u);
            
            int total = 0;
            for(int p : pars) {
                if(infected[p] == 1) {
                    total+= size[p];
                }
            }
            
            if(total>=max) {
                if(total == max) {
                    ans = Math.min(ans, u);
                }else {
                    ans = u;
                }
                max = total;
            }
        }
        
        if(ans == -1) {
            int min = n + 1;
            for(int e : initial) {
                min = Math.min(min, e);
            }
            
            return min; 
        }
        
        return ans;
    }
    
    private boolean union(int p1, int p2) {
        int lp1 = find(p1);
        int lp2 = find(p2);
        
        if(lp1 == lp2) return true;
        
        if(size[lp1] > size[lp2]) {
            parent[lp2] = lp1;
            size[lp1]++;
        }else if(size[lp2] > size[lp1]) {
            parent[lp1] = lp2;
            size[lp2]++;
        }else {
            parent[lp2] = lp1;
            size[lp1]++;
        }
        
        return true;
    }
    
    private int find(int x) {
        if(parent[x] == x) return x;
        
        return parent[x] = find(parent[x]);
    }
}